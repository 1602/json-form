<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>JSON Form web-component demo</title>
        <!--link rel="stylesheet" href="https://unpkg.com/@ubio/css@1.3.11/index.css"></link-->
        <script src="https://unpkg.com/json-viewer-custom-element"></script>
        <script src="/highlight.pack.js"></script>

        <script>
            const q = document.querySelector.bind(document);

            window.addEventListener('load', () => {
                const form = q('json-form');
                const viewer = q('json-viewer');
                if (form && viewer) {
                    connect(form, viewer);
                }
            });

            hljs.initHighlighting();

            function connect(form, viewer) {
                form.addEventListener('change', () =>
                    viewer.setAttribute('value', form.getAttribute('value'))
                );
            }

            customElements.define('code-sample', class extends HTMLElement {
                static get observedAttributes() {
                    return ['code'];
                }
                constructor() {
                    super();
                    const appRoot = document.createElement('pre');
                    const shadowRoot = this.attachShadow({ mode: 'open' });
                    const styles = document.createElement('link');
                    styles.setAttribute('rel', 'stylesheet');
                    styles.setAttribute('href', '/solarized-dark.css');
                    shadowRoot.appendChild(styles);
                    shadowRoot.appendChild(appRoot);
                    this.appRoot = appRoot;
                }

                connectedCallback() {
                    this.appRoot.textContent = this.getAttribute('code');
                    hljs.highlightBlock(this.appRoot);
                }

                attributeChangedCallback(name, oldValue, newValue) {
                    switch (name) {
                        case 'code':
                            if (oldValue !== newValue) {
                                this.appRoot.textContent = this.getAttribute('code');
                                hljs.highlightBlock(this.appRoot);
                            }
                    }
                }
            });

        </script>
        <style>
            json-viewer { margin: 50px; display: block; }
            json-form { margin: 50px; display: block; }
        </style>
    </head>
    <body>
        <!--
        <json-form
                schema='{"type":"string","title":"Greeting","maxLength":5,"description":"Enter any greeting"}'
          value='"hello"'
        ></json-form>

        <json-viewer
            value='"hello"'
        ></json-viewer>
        -->
    </body>
</html>
